<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PLC Data Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-3xl font-bold text-blue-700 mb-6 text-center">PLC Live Data</h1>
    <table class="min-w-full border border-gray-300">
      <thead class="bg-blue-200">
        <tr>
          <th class="p-3 border border-gray-300 text-left">Timestamp</th>
          <th class="p-3 border border-gray-300 text-left">Sensor Value</th>
        </tr>
      </thead>
      <tbody id="dataTable" class="text-center text-gray-700"></tbody>
    </table>
  </div>

  <script>
    // Format ISO datetime string to 'YYYY-MM-DD HH:mm:ss' local time
    function formatDateTime(isoString) {
      const date = new Date(isoString);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      const seconds = String(date.getSeconds()).padStart(2, '0');
      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }

    async function fetchCSV() {
      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbzo1t2Xy4ZRmYLOjt4f9rpbgrUeOq_vp-iY0F6pLeTHfi5sFJj-1UlqnwD3LiL-abqjAw/exec");
        const text = await response.text();
        const rows = text.trim().split("\n");

        const tableBody = document.getElementById("dataTable");
        tableBody.innerHTML = "";

        rows.forEach(row => {
          const cells = row.split(",");
          // Format timestamp cell
          const formattedTime = formatDateTime(cells[0]);
          tableBody.innerHTML += `
            <tr class="hover:bg-gray-100">
              <td class="p-3 border border-gray-300">${formattedTime}</td>
              <td class="p-3 border border-gray-300">${cells[1]}</td>
            </tr>
          `;
        });
      } catch (error) {
        console.error("Failed to fetch or parse data:", error);
      }
    }

    fetchCSV();
    setInterval(fetchCSV, 5000); // refresh every 5 seconds
  </script>
</body>
</html>
